#!/usr/bin/env node

'use strict';

// Set process title
process.title = 'nengine';

var nengine, // Nengine module
    path = require('path'),
    basedir = process.cwd(),
    resolve = require('../lib/resolve'), // Internal libs
    help = require('../lib/help'),
    options = require('../lib/cli').options; // Especially badass external libs

// Do stuff based on CLI options.
if (options.version) {
    // Display version
    help.version();
} else if (options.configfile) {
    // Note: if both `configfile` and `root` are set, use `configfile` dirname
    basedir = path.dirname(options.configfile);
} else if (options.root) {
    basedir = options.root;
}

// Run local nengine
try {
    // Find local nengine and require local nengine and run it
    require(resolve('nengine', basedir)).cli();
} catch (e) {
    // Not find local nengine
    // Show version info, exit process
    options.version && process.exit();
    // Show help info
    options.help && help.help();
    // Show fatal info
    help.fatal('Unable to find local nengine under the root directory', 99);
}
