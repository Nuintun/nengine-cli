#!/usr/bin/env node

'use strict';

// Set process title
process.title = 'nengine';

var nenginepath, // Nengine module path
    path = require('path'), // Internal libs
    basedir = process.cwd(),
    help = require('../lib/help'),
    findup = require('findup-sync'), // Especially badass external libs
    resolve = require('resolve').sync,
    options = require('../lib/cli').options;

// Do stuff based on CLI options.
if (options.version) {
    // Show version
    help.version();
} else if (options.configfile) {
    //Note: if both `configfile` and `root` are set, use `configfile`
    basedir = path.dirname(options.configfile);
} else if (options.root) {
    basedir = options.root;
}

// Find local nengine
try {
    nenginepath = resolve('nengine', { basedir: basedir });
} catch (e) {
    nenginepath = findup('nengine/lib/nengine.js');

    // No local nengine found
    if (!nenginepath) {
        // Show version info, exit process
        options.version && process.exit();
        // Show help info
        options.help && help.help();
        // Show fatal info
        help.fatal('Unable to find local nengine', 99);
    }
}

// Everything looks good. Require local nengine and run it.
require(nenginepath).cli();